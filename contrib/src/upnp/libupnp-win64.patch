From 9ea9e7de1958a938c8524dba31b163529f4bc1a4 Mon Sep 17 00:00:00 2001
From: Eden Abitbol <eden.abitbol@savoirfairelinux.com>
Date: Mon, 3 Jun 2019 18:04:25 -0400
Subject: [PATCH] win64 patch.

---
 upnp/inc/upnp.h                  | 13 +++++++++++++
 upnp/src/threadutil/ThreadPool.h |  2 ++
 2 files changed, 15 insertions(+)

diff --git a/upnp/inc/upnp.h b/upnp/inc/upnp.h
index 1b2211d..dfddc03 100644
--- a/upnp/inc/upnp.h
+++ b/upnp/inc/upnp.h
@@ -61,6 +61,19 @@
 	/* Other systems ??? */
 #endif
 
+#if defined( __MINGW32__ )
+	#if !defined( _OFF_T_ )
+		typedef long long _off_t;
+		typedef _off_t off_t;
+		#define _OFF_T_
+	#else
+		#ifdef off_t
+			#undef off_t
+		#endif
+		#define off_t long long
+	#endif
+#endif
+
 #ifdef UPNP_ENABLE_OPEN_SSL
 #include <openssl/ssl.h>
 #endif
diff --git a/upnp/src/threadutil/ThreadPool.h b/upnp/src/threadutil/ThreadPool.h
index adcca6e..327413b 100644
--- a/upnp/src/threadutil/ThreadPool.h
+++ b/upnp/src/threadutil/ThreadPool.h
@@ -46,6 +46,7 @@
 #include <errno.h>
 
 #ifdef _WIN32
+#ifndef _TIMEZONE_DEFINED
 	#include <time.h>
 	struct timezone
 	{
@@ -53,6 +54,7 @@
 		int  tz_dsttime;     /* type of dst correction */
 	};
 	int gettimeofday(struct timeval *tv, struct timezone *tz);
+#endif
 #else /* _WIN32 */
 	#include <sys/param.h>
 	#include <sys/time.h> /* for gettimeofday() */
-- 
2.17.1

