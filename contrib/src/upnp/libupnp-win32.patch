From 49063c1cc31f168f07e174aef63e7b39bc17af46 Mon Sep 17 00:00:00 2001
From: Eden Abitbol <eden.abitbol@savoirfairelinux.com>
Date: Mon, 3 Jun 2019 18:14:40 -0400
Subject: [PATCH] win32 patch

---
 configure.ac            |  2 ++
 libupnp.pc.in           |  2 +-
 upnp/src/inc/upnputil.h | 10 +++++-----
 3 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/configure.ac b/configure.ac
index 190b30c..3c25758 100644
--- a/configure.ac
+++ b/configure.ac
@@ -552,6 +552,8 @@ fi
 
 RT_BOOL_ARG_ENABLE([samples], [yes], [compilation of upnp/sample/ code])
 
+AC_DEFINE([_WIN32_WINNT], 0x0501, [Define to '0x0500' for Windows 2000 APIs.])
+
 #
 # Checks for programs
 #
diff --git a/libupnp.pc.in b/libupnp.pc.in
index 8c6fc22..8ae508b 100644
--- a/libupnp.pc.in
+++ b/libupnp.pc.in
@@ -6,7 +6,7 @@ includedir=@includedir@
 Name: libupnp
 Description: Linux SDK for UPnP Devices
 Version: @VERSION@
-Libs: @PTHREAD_CFLAGS@ @PTHREAD_LIBS@ -L${libdir} -lupnp -lixml
+Libs: @PTHREAD_CFLAGS@ -L${libdir} -lupnp -lthreadutil -lixml -liphlpapi @PTHREAD_LIBS@ 
 Libs.private: @OPENSSL_LIBS@
 Cflags: @PTHREAD_CFLAGS@ -I${includedir}/upnp
 
diff --git a/upnp/src/inc/upnputil.h b/upnp/src/inc/upnputil.h
index 010b1a7..ad52836 100644
--- a/upnp/src/inc/upnputil.h
+++ b/upnp/src/inc/upnputil.h
@@ -126,11 +126,11 @@ void linecopylen(
 		#ifndef EADDRINUSE		/* VS2010 has this defined */
 			#define EADDRINUSE		WSAEADDRINUSE
 		#endif
-		#define strcasecmp		stricmp
-		#define strncasecmp		strnicmp
-		#define sleep(a)		Sleep((a)*1000)
-		#define usleep(a)		Sleep((a)/1000)
-		#define strerror_r(a,b,c)	(strerror_s((b),(c),(a)))
+		#define strcasecmp		  stricmp
+		#define strncasecmp		  strnicmp
+		#define sleep(a)		  Sleep((a)*1000)
+		#define usleep(a)		  Sleep((a)/1000)
+		#define strerror_r(a,b,c) strncpy(b, strerror(a), c)
 	#else
 		#define max(a, b)   (((a)>(b))? (a):(b))
 		#define min(a, b)   (((a)<(b))? (a):(b))
-- 
2.17.1

