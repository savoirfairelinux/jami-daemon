#!/bin/sh

tmp=$(mktemp --directory)

export XDG_CONFIG_HOME=$tmp
export XDG_CACHE_HOME=$tmp
export XDG_DATA_HOME=$tmp

archive=$1

inputs=$(mktemp --suffix=.scm)
outputs=$(mktemp)

cat -> "$inputs" <<EOF
(agent:ensure-account)
(agent->archive "${archive}")
EOF

JAMI_LOG_FILE="$outputs" ./agent "$inputs"

grep AGENT "$outputs"

rm "$inputs"
rm "$outputs"
rm -rf "$tmp"
